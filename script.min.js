var info={cat:null,page:null,text:null};var tramiteSelected=null;var tramiteSelectedName=null;$(document).on("mobileinit",function(){$.mobile.buttonMarkup.hoverDelay=0;$.mobile.defaultPageTransition="none";$.mobile.defaultDialogTransition="none"});$(document).on("vclick","#movie-list li",function(){event.preventDefault();$.mobile.navigate("#headline");$.mobile.changePage("#headline");$("#headlineTitle",$.mobile.activePage).text($(this).attr("data-name"));var a=$(this).attr("data-id");info.cat=a;info.page=0;$("#movie-data",$.mobile.activePage).empty();fetchDataFromServer();return false});$(document).on("vclick","#movie-data li",function(){event.preventDefault();var c=$(this).attr("data-id");tramiteSelected=c;var b=$(this).attr("data-name");tramiteSelectedName=b;$.mobile.navigate("#tramiteDetail");$("#headerTramiteDetail").text(tramiteSelectedName);loading=true;$.mobile.loading("show");var a="http://developer.konacloud.io/api/taio/TramitesUY/r_getTramiteById?id="+tramiteSelected;$.getJSON(a,function(f){var e=f.data;$("#queEsId",$.mobile.activePage).text(e.queEs);if(e.dondeyCuando!=null){$("#dondeYCuandoId",$.mobile.activePage).text(e.dondeyCuando.otrosDatosUbicacion)}else{$("#dondeYCuandoId",$.mobile.activePage).text("N/A")}$("#requisitos",$.mobile.activePage).text(e.requisitos);if(e.tenerEnCuenta!=null&&e.tenerEnCuenta.costo!=null&&e.tenerEnCuenta.otrosDatosDeInteres!=null&&e.tenerEnCuenta.formaDeSolicitarlo!=null){var g="<b>Costo:</b> "+e.tenerEnCuenta.costo+"<br><b>Otros datos:</b> "+e.tenerEnCuenta.otrosDatosDeInteres+"<br><b>Forma de solicitud:</b> "+e.tenerEnCuenta.formaDeSolicitarlo;$("#observacionesId",$.mobile.activePage).html(g);var d="<b> Area </b> : "+e.dependeDe.area+"<br><b> Organismo </b> : "+e.dependeDe.organismo;$("#dependeDeId",$.mobile.activePage).html(d)}loading=false;$.mobile.loading("hide")});return false});var fetchDataFromServer=function(){$.getJSON("http://developer.konacloud.io/api/taio/TramitesUY/mr_tramiteCats?cat="+info.cat+"&p="+info.page,function(a){var b=a.data;b.forEach(function(e){var d=e.titulo;var c=$("<li/>");c.attr("data-id",e.tramiteId);c.attr("data-name",e.titulo);var f=$("<a/>").append(d);f.addClass("ui-btn ui-btn-a ui-btn-icon-right ui-icon-carat-r");c.append(f);c.appendTo("#movie-data")});info.page=info.page+1;$("#movie-data",$.mobile.activePage).listview("refresh");loading=false;$.mobile.loading("hide")})};var fetchDataFromServerRegExp=function(a){$.getJSON("http://developer.konacloud.io/api/taio/TramitesUY/r_searchTramitesByTitulo?name="+info.text+"&p="+info.page,function(b){console.log(b);var c=b.data;c.forEach(function(f){var e=f.titulo;var d=$("<li/>");d.attr("data-id",f.tramiteId);d.attr("data-name",f.titulo);var g=$("<a/>").append(e);g.addClass("ui-btn ui-btn-a ui-btn-icon-right ui-icon-carat-r");d.append(g);d.appendTo("#search-page-list-view")});info.page=info.page+1;$("#search-page-list-view",$.mobile.activePage).listview("refresh");loading=false;$.mobile.loading("hide")})};$(window).bind("scrollstart",function(){event.preventDefault();var a=$.mobile.activePage.attr("id");if(a!="headline"&&a!="searchPage"){return}if(isAtBottom()){loading=true;$.mobile.loading("show");if(a=="headline"){fetchDataFromServer()}else{fetchDataFromServerRegExp(info.text)}}return false});$(window).bind("scrollstop",function(){event.preventDefault();return false});function isAtBottom(){return($(window).scrollTop()>=$(document).height()-$(window).height()-100)}$(document).ready(function(){$("#btnBuscar").click(function(){event.preventDefault();var a=$("#searchTramite",$.mobile.activePage).val();$.mobile.navigate("#searchPage");$.mobile.changePage("#searchPage");$("#searchPageTitle",$.mobile.activePage).text("Resultados para "+a);info.text=a;info.page=0;$("#search-page-list-view",$.mobile.activePage).empty();fetchDataFromServerRegExp(a);return false})});$(document).on("vclick","#search-page-list-view li",function(){event.preventDefault();var c=$(this).attr("data-id");tramiteSelected=c;var b=$(this).attr("data-name");tramiteSelectedName=b;$.mobile.navigate("#tramiteDetail");$("#headerTramiteDetail",$.mobile.activePage).text(tramiteSelectedName);loading=true;$.mobile.loading("show");var a="http://developer.konacloud.io/api/taio/TramitesUY/r_getTramiteById?id="+tramiteSelected;$.getJSON(a,function(f){var e=f.data;$("#queEsId",$.mobile.activePage).text(e.queEs);if(e.dondeyCuando!=null){$("#dondeYCuandoId",$.mobile.activePage).text(e.dondeyCuando.otrosDatosUbicacion)}else{$("#dondeYCuandoId",$.mobile.activePage).text("N/A")}$("#requisitos",$.mobile.activePage).text(e.requisitos);if(e.tenerEnCuenta!=null&&e.tenerEnCuenta.costo!=null&&e.tenerEnCuenta.otrosDatosDeInteres!=null&&e.tenerEnCuenta.formaDeSolicitarlo!=null){var g="<b>Costo:</b> "+e.tenerEnCuenta.costo+"<br><b>Otros datos:</b> "+e.tenerEnCuenta.otrosDatosDeInteres+"<br><b>Forma de solicitud:</b> "+e.tenerEnCuenta.formaDeSolicitarlo;$("#observacionesId",$.mobile.activePage).html(g);var d="<b> Area </b> : "+e.dependeDe.area+"<br><b> Organismo </b> : "+e.dependeDe.organismo;$("#dependeDeId",$.mobile.activePage).html(d)}loading=false;$.mobile.loading("hide")});return false});